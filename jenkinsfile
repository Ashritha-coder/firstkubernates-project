pipeline {
  agent any

  parameters {
    choice(
      name: 'DEPLOY_COLOR',
      choices: ['blue', 'green'],
      description: 'Choose which version to deploy'
    )
  }

  stages {

    stage('Checkout') {
      steps {
        git branch: 'main',
            url: 'https://github.com/Ashritha-coder/firstkubernates-project.git'
      }
    }

    stage('Deploy to Kubernetes') {
      steps {
        dir('Blue-Green-Deployment') {
          sh '''
            if [ "$DEPLOY_COLOR" = "blue" ]; then
              kubectl apply -f app-deployment-blue.yml
            else
              kubectl apply -f app-deployment-green.yml
            fi

            kubectl apply -f bankapp-service.yml
          '''
        }
      }
    }
  }
}
